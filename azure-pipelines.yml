parameters:
# The full path to the folder containing the project.json file for this pipeline
- name: 'projectPath'
  default: '.'
  type: string
# The name of the folder to deploy the package to.
- name: 'folderName'
  default: 'AzureDevOps'
  type: string
# Either AutoVersion to generate a build number or CurrentVersion to match the project.json version.
- name: 'versioningStrategy'
  default: 'CurrentVersion'
  type: string


# This pipeline is broken into stages for the approval functionality. Stages are ran independantly, which means the pipeline can pause until the approval is received. 
stages:
# Build the nuget package.
- stage: Build
  jobs:
  - job: PackAndDeployProcess
    pool: Default # Update this if using dedicated build pool


    workspace:
      clean: all
    steps:
    
      #- task: UiPathInstallPlatform@4  # This installs required exes. Not necessary if using a dedicated build machine.
      - task: UiPathInstallPlatform-preview@4
        inputs:
          cliVersion: 'WIN_23.10.8753.32995'
          #cliNupkgPath: 'C:\Users\marian.platonov\Desktop\UiPath CLI\UiPath.CLI.Windows.23.10.8753.32995.nupkg'
          cliNupkgPath: ''

      - task: UiPathPack-preview@4
        inputs:
          versionType: 'AutoVersion'
          projectJsonPath: 'C:\Users\marian.platonov\Desktop\UiPath CLI\Test_project\TestInsertimageWindows\project.json'
          outputType: 'Process'
          orchestratorConnection: 'UiPath Cloud Connection for marianplatonov'
          outputPath: '$(Build.ArtifactStagingDirectory)\Output'
          traceLevel: 'Verbose'

      - task: UiPathDeploy-preview@4
        inputs:
          orchestratorConnection: 'UiPath Cloud Connection for marianplatonov'
          packagesPath: '$(Build.ArtifactStagingDirectory)\Output'
          folderName: 'AzureDevOps'
          traceLevel: 'Verbose'

      - task: UiPathTest-preview@4
        inputs:
          testTarget: 'TestProject'
          orchestratorConnection: 'UiPath Cloud Connection for marianplatonov'
          testProjectPath: 'C:\Users\marian.platonov\Desktop\UiPath CLI\TestAutomationProject3.1.0.145194094\content\project.json'
          folderName: 'Test Cases'
          testReportDestination: '$(Build.ArtifactStagingDirectory)\drop'
          traceLevel: 'Verbose'
          attachRobotLogs: true